version: '2'
services:
  ui:
    image: opencadc/search
    ports:
      - '8080:8080'
      - '5555:5555'
    networks:
      - 'caom2'
    depends_on:
      - tap
      - caom2ui
      - uwspg
    volumes:
      - /usr/local/search/ui/webapps:/usr/local/tomcat/webapps
      - /usr/local/search/config:/root/config
  uwspg:
    image: opencadc/uws_postgres
    networks:
      - 'caom2'
    environment:
      - POSTGRES_USER=uws
      - POSTGRES_PASSWORD=astr0query
      - PGDATA=/var/lib/postgresql/data/uws
    volumes:
      - /var/lib/postgresql/data
      - /var/run/postgresql
  caom2ops:
    image: opencadc/caom2ops
    networks:
      - 'caom2'
    depends_on:
      - caom2opspg
    volumes:
      - /usr/local/search/caom2ops/webapps:/usr/local/tomcat/webapps
      - /root/.pub
  caom2opspg:
    image: opencadc/uws_postgres
    networks:
      - 'caom2'
    environment:
      - POSTGRES_USER=caom2ops
      - POSTGRES_PASSWORD=astr0query
      - PGDATA=/var/lib/postgresql/data/uws
    volumes:
      - /var/lib/postgresql/data
      - /var/run/postgresql
  caom2ui:
    image: opencadc/caom2ui
    networks:
      - 'caom2'
    volumes:
      - /usr/local/search/caom2ui/webapps:/usr/local/tomcat/webapps
      - /usr/local/search/config:/root/config
    depends_on:
      - caom2ops
  caom2repo:
    image: opencadc/caom2repo
    networks:
      - 'caom2'
    depends_on:
      - tappg
#    volumes:
#      - /usr/local/search/config:/root/config
#      - /usr/local/search/caom2repo/webapps:/usr/local/tomcat/webapps
  tap:
    image: opencadc/tap
    networks:
      - 'caom2'
    depends_on:
      - tappg
    volumes:
      - /usr/local/search/tap/webapps:/usr/local/tomcat/webapps
      - /usr/local/search/pub:/root/.pub
  tappg:
    image: opencadc/tap_postgres
    networks:
      - 'caom2'
    environment:
      - POSTGRES_USER=tap
      - POSTGRES_PASSWORD=astr0query
      - PGDATA=/var/lib/postgresql/data/tap
    volumes:
      - /var/lib/postgresql/data
      - /var/run/postgresql

# Create the network 'archive' for which this system will run within.
networks:
  caom2:
    driver: 'bridge'
